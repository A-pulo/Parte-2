<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Trabalho 3</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    </head>
    <body>
        <main class="container bg-secondary align-center jumbotron vertical-center" style="margin-top:30px; border-width: 3px; border-style: solid; border-color: black;">
            <form action="" class="needs-validation text-white" id="cliente" method="POST">
                <div class = "row mx-1 my-2">
                    <div class="col-1"></div>
                    <div class="col-4">
                        <label for="nome"><b>Nome</b></label>
                        <input type="text" class="form-control" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="nome" placeholder="Nome" name="nome" required>
                    </div>
                    <div class="col-3">
                        <label for="cpf"><b>CPF/CNPJ</b></label>
                        <input type="text" class="form-control" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="cpf" placeholder="cpf/cnpj" name="cpf" required>
                    </div>
                    <div class="col-2">
                        <label for="ie"><b>Inscrição Estadual</b></label>
                        <input type="text" class="form-control" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="ie" placeholder="IE" name="ie" required>
                    </div>
                    <div class="col-1">
                        <label for="uf"><b>Uf</b></label>
                        <input type="text" class="form-control" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="uf" placeholder="UF" name="uf" required>
                    </div>    
                    <div class="col-1"></div>
                </div>
                <div class = "row mx-1 my-2">
                    <div class="col-1"></div>
                    <div class="col-4">
                        <label for="email"><b>E-Mail</b></label>
                        <input type="text" class="form-control" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="email" placeholder="e-mail" name="email" required>
                    </div>
                    <div class="col-3">
                        <label for="telefone"><b>Telefone</b></label>
                        <input type="text" class="form-control" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="telefone" placeholder="Telefone" name="telefone" required>
                    </div>
                    <div class="col-3">
                        <label for="cep"><b>Cep</b></label>
                        <input type="text" class="form-control" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="cep" placeholder="Cep" name="cep" required>
                    </div>       
                    <div class="col-1"></div>
                </div>
                <div class = "row mx-1 my-2">
                    <div class="col-1"></div>
                    <div class="col-5">
                        <label for="rua"><b>Rua</b></label>
                        <input type="text" class="form-control" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="rua" placeholder="Rua" name="rua" required>
                    </div>
                    <div class="col-1">
                        <label for="numero"><b>Nº</b></label>
                        <input type="text" class="form-control" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="numero" placeholder="Nº" name="numero" required>
                    </div>
                    <div class="col-4">
                        <label for="complemento"><b>Complemento</b></label>
                        <input type="text" class="form-control" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="complemento" placeholder="Complemento" name="complemento" required>
                    </div>
                    <div class="col-1"></div>
                </div>
                </br>
                <div class = "row mx-1 my-2">
                    <div class = "col-2"></div>
                    <button type="button" class="col-3 btn btn-dark" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id ="Salvar" onclick="criarCliente()"><b>Salvar</b></button>
                    <div class = "col-2"></div>
                    <button type="reset" class="col-3 btn btn-dark" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id ="Cancelar" onclick="resetSaveCliente();"><b>Cancelar</b></button>
                    <div class = "col-2"></div>
                </div>
                </br>
            </form>
            <form action="" class="needs-validation text-white" id="lacre" method="POST">
                <div class = "row mx-1 my-2">
                    <div class="col-1"></div>
                    <div class="col-2">
                        <label for="nr_serie"><b>Numero de Serie</b></label>
                        <input type="text" class="form-control" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="nr_serie" placeholder="Numero de Serie" name="nr_serie" required>
                    </div>
                    <div class="col-2">
                        <label for="lote"><b>Lote</b></label>
                        <input type="text" class="form-control" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="lote" placeholder="Lote" name="lote" required>
                    </div>
                    <div class="col-2">
                        <label for="data_entrada"><b>Data de Entrada</b></label>
                        <input type="text" class="form-control" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="data_entrada" placeholder="Data de Entrada" name="data_entrada" required>
                    </div>
                    <div class="col-2">
                        <label for="data_baixa"><b>Data de Baixa</b></label>
                        <input type="text" class="form-control" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="data_baixa" placeholder="Data de Baixa" name="data_baixa" required>
                    </div>
					<div class="col-2">
                        <label for="id_cliente_lacrado"><b>Cliente</b></label>
                        <input type="text" class="form-control" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="id_cliente_lacrado" placeholder="ID Cliente" name="id_cliente_lacrado" required>
                    </div>    
                    <div class="col-1"></div>
                </div>
                </br>
                <div class = "row mx-1 my-2">
                    <div class = "col-2"></div>
                    <button type="button" class="col-3 btn btn-dark" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id ="SalvarLacre" onclick="criarLacre()"><b>Salvar</b></button>
                    <div class = "col-2"></div>
                    <button type="reset" class="col-3 btn btn-dark" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id ="CancelarLacre" onclick="resetSaveLacre();"><b>Cancelar</b></button>
                    <div class = "col-2"></div>
                </div>
                </br>
            </form>
            <div class = "row mx-1 my-2">
                <div class = "col-1"></div>
                <button class=" col-4 mx-auto btn-dark" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" onclick="loadTableCliente()">Carregar clientes</button>
                <div class = "col-2"></div>
                <button class=" col-4 mx-auto btn-dark" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" onclick="loadTableLacre()">Carregar lacres</button>
                <div class = "col-1"></div>
            </div>
            <div class = "row mx-1 my-2">
                <table class= "col-12 mx-auto table-sm table-dark table-striped table-hover table-bordered" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" id="tabela">
                    <tr>
                      <th>Id</th>
                      <th>Nome</th>
                      <th>cpf</th>
                      <th>IE</th>
                      <th>UF</th>
                      <th>Email</th>
                      <th>Telefone</th>
                      <th>Cep</th>
                      <th>Rua</th>
                      <th>Nr</th>
                      <th>Complemento</th>
                      <th>Ação</th>
                    </tr>
                </table>
            </div>
            <div class = "row mx-1 my-2">
                <div class = "col-1"></div>
                <button class=" col-4 mx-auto btn-dark" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" onclick="loadTableCliente()">Carregar clientes</button>
                <div class = "col-2"></div>
                <button class=" col-4 mx-auto btn-dark" style="border-width: 2px; border-radius: 5px; border-style: solid; border-color: black;" onclick="loadTableLacre()">Carregar lacres</button>
                <div class = "col-1"></div>
            </div>
        </main>
            <script>
                //Scripts do cliente
                function resetSaveCliente() {
                    document.getElementById("Salvar").setAttribute("onclick", "criarCliente()");
                }
                function loadCliente(cliente) {
                    document.getElementById("nome").value = cliente[1].nome;
                    document.getElementById("telefone").value = cliente[1].telefone;
                    document.getElementById("email").value = cliente[1].email;
                    document.getElementById("cpf").value = cliente[1].cpf;
                    document.getElementById("ie").value = cliente[1].ie;
                    document.getElementById("rua").value = cliente[1].rua;
                    document.getElementById("numero").value = cliente[1].numero;
                    document.getElementById("complemento").value = cliente[1].complemento;
                    document.getElementById("cep").value = cliente[1].cep;
                    document.getElementById("uf").value  = cliente[1].uf;
                    document.getElementById("Salvar").setAttribute("onclick", "updateCliente('"+cliente[1].id+"')");
                    console.log(document.getElementById("Salvar"));
                }

                function getCliente(idcliente){
                    var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            var response = Object.values(JSON.parse(this.responseText));
                            console.log(response);
                            loadCliente(response);
                        }
                    };
                    xhttp.open("GET", "https://private-e53594-apulo.apiary-mock.com/clientes/"+idcliente, true);
                    xhttp.send();
                }

                function updateCliente(idcliente){
                    var xhttp = new XMLHttpRequest();
                    var registro = {
                        nome: document.getElementById("nome").value,
                        telefone: document.getElementById("telefone").value,
                        email: document.getElementById("email").value,
                        cpf: document.getElementById("cpf").value,
                        ie: document.getElementById("ie").value,
                        rua: document.getElementById("rua").value,
                        numero: document.getElementById("numero").value,
                        complemento: document.getElementById("complemento").value,
                        cep: document.getElementById("cep").value,
                        uf: document.getElementById("uf").value
                    };
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            var response = JSON.parse(this.responseText);
                            console.log(response);
                        }
                    };
                    xhttp.open("PUT", "https://private-e53594-apulo.apiary-mock.com/updatecliente/"+idcliente, true);
                    xhttp.setRequestHeader("Content-type", "application/json");
                    xhttp.send(JSON.stringify(registro));
                    console.log(JSON.stringify(registro));
                    resetSaveCliente();
                }

                function deleteCliente(idcliente){
                    if (confirm("Deseja excluir o cliente " + idcliente + " ?")) {
                        var xhttp = new XMLHttpRequest();
                        xhttp.onreadystatechange = function() {
                            if (this.readyState == 4 && this.status == 200) {
                                var response = JSON.parse(this.responseText);
                                console.log(response);
                            }
                        };
                        xhttp.open("DELETE", "https://private-e53594-apulo.apiary-mock.com/deletecliente/"+idcliente, true);
                        xhttp.send();
                    }
                }
                
                function criarCliente() {
                    var xhttp = new XMLHttpRequest();
                    var registro = {
                        nome: document.getElementById("nome").value,
                        telefone: document.getElementById("telefone").value,
                        email: document.getElementById("email").value,
                        cpf: document.getElementById("cpf").value,
                        ie: document.getElementById("ie").value,
                        rua: document.getElementById("rua").value,
                        numero: document.getElementById("numero").value,
                        complemento: document.getElementById("complemento").value,
                        cep: document.getElementById("cep").value,
                        uf: document.getElementById("uf").value
                    };
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 201) {
                            var response = JSON.parse(this.responseText);
                            console.log(response);
                        }
                    };
                    xhttp.open("POST", "https://private-e53594-apulo.apiary-mock.com/createcliente", true);
                    xhttp.setRequestHeader("Content-type", "application/json");
                    xhttp.send(JSON.stringify(registro));
                    console.log(JSON.stringify(registro));
                }

                function loadTableCliente() {
                    var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            var response = JSON.parse(this.responseText);
                            document.getElementById("tabela").innerHTML="<tr><th>Id</th><th>Nome</th><th>cpf</th><th>IE</th><th>UF</th><th>Email</th><th>Telefone</th><th>Cep</th><th>Rua</th><th>Nr</th><th>Complemento</th><th>Ação</th></tr>"
                            document.getElementById("tabela").insertAdjacentHTML("beforeend", createRowsCliente(response.retorno));
                            console.log(response);
                        }
                    };
                    xhttp.open("GET", "https://private-e53594-apulo.apiary-mock.com/clientes", true);
                    xhttp.send();
                }

                function createRowsCliente(retorno){
                    var htmlString = "";
                    for (i = 0; i < retorno.length; i++){
                        htmlString += "<tr>" +
                        "<td> <p class=\"mx-1 my-1\">"+retorno[i].id +"</p></td>" +
                        "<td>" + retorno[i].nome + "</td>" + 
                        "<td>" + retorno[i].cpf+ "</td>" + 
                        "<td>" + retorno[i].ie+ "</td>" +
                        "<td>" + retorno[i].uf+ "</td>" +
                        "<td>" + retorno[i].email+ "</td>" +
                        "<td>" + retorno[i].telefone+ "</td>" +
                        "<td>" + retorno[i].cep+ "</td>" +
                        "<td>" + retorno[i].rua+ "</td>" +
                        "<td>" + retorno[i].numero+ "</td>" +
                        "<td>" + retorno[i].complemento+ "</td>" +
                        "<td><p class=\"mx-1 my-1\"><button type=\"button\" class=\"btn btn-link\" onclick=\"getCliente('" + retorno[i].id + "')\">Editar</button> | <button type=\"button\" class=\"btn btn-link\" onclick=\"deleteCliente('" + retorno[i].id + "')\">Excluir</button>" +
                        "</tr>"
                    }
                    return htmlString;
                }
            // Scripts dos lacres
            function resetSaveLacre() {
                    document.getElementById("SalvarLacre").setAttribute("onclick", "criarLacre()");
                }
                function loadLacre(lacre) {
                    document.getElementById("nr_serie").value = lacre[1].nr_serie;
                    document.getElementById("lote").value = lacre[1].lote;
                    document.getElementById("data_entrada").value = lacre[1].data_entrada;
                    document.getElementById("data_baixa").value = lacre[1].data_baixa;
                    document.getElementById("id_cliente_lacrado").value = lacre[1].id_cliente_lacrado;
                    document.getElementById("SalvarLacre").setAttribute("onclick", "updateLacre('"+lacre[1].nr_serie+"')");
                    console.log(document.getElementById("SalvarLacre"));
                }

                function getLacre(idlacre){
                    var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            var response = Object.values(JSON.parse(this.responseText));
                            console.log(response);
                            loadLacre(response);
                        }
                    };
                    xhttp.open("GET", "https://private-e53594-apulo.apiary-mock.com/lacres/"+idlacre, true);
                    xhttp.send();
                }

                function updateLacre(idlacre){
                    var xhttp = new XMLHttpRequest();
                    var registro = {
                        nr_serie: document.getElementById("nr_serie").value,
                        lote: document.getElementById("lote").value,
                        data_entrada: document.getElementById("data_entrada").value,
                        data_baixa: document.getElementById("data_baixa").value,
                        id_cliente_lacrado: document.getElementById("id_cliente_lacrado").value,
                    };
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            var response = JSON.parse(this.responseText);
                            console.log(response);
                        }
                    };
                    xhttp.open("PUT", "https://private-e53594-apulo.apiary-mock.com/updatelacre/"+idlacre, true);
                    xhttp.setRequestHeader("Content-type", "application/json");
                    xhttp.send(JSON.stringify(registro));
                    console.log(JSON.stringify(registro));
                    resetSaveLacre();
                }
                
                function criarLacre() {
                    var xhttp = new XMLHttpRequest();
                    var registro = {
                        nr_serie: document.getElementById("nr_serie").value,
                        lote: document.getElementById("lote").value,
                        data_entrada: document.getElementById("data_entrada").value,
                        data_baixa: document.getElementById("data_baixa").value,
                        id_cliente_lacrado: document.getElementById("id_cliente_lacrado").value,
                    };
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 201) {
                            var response = JSON.parse(this.responseText);
                            console.log(response);
                        }
                    };
                    xhttp.open("POST", "https://private-e53594-apulo.apiary-mock.com/createlacre", true);
                    xhttp.setRequestHeader("Content-type", "application/json");
                    xhttp.send(JSON.stringify(registro));
                    console.log(JSON.stringify(registro));
                }

                function loadTableLacre() {
                    var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            var response = JSON.parse(this.responseText);
                            document.getElementById("tabela").innerHTML="<tr><th>Numero de serie</th><th>Lote</th><th>Data de Entrada</th><th>Data de Baixa</th><th>Id do Cliente Lacrado</th><th>Ação</th></tr>"
                            document.getElementById("tabela").insertAdjacentHTML("beforeend", createRowsLacre(response.retorno));
                            console.log(response);
                        }
                    };
                    xhttp.open("GET", "https://private-e53594-apulo.apiary-mock.com/lacres", true);
                    xhttp.send();
                }

                function createRowsLacre(retorno){
                    var htmlString = "";
                    for (i = 0; i < retorno.length; i++){
                        htmlString += "<tr>" +
                        "<td> <p class=\"mx-1 my-1\">"+retorno[i].nr_serie +"</p></td>" +
                        "<td>" + retorno[i].lote + "</td>" + 
                        "<td>" + retorno[i].data_entrada + "</td>" + 
                        "<td>" + retorno[i].data_baixa + "</td>" +
                        "<td>" + retorno[i].id_cliente_lacrado + "</td>" +
                        "<td><p class=\"mx-1 my-1\"><button type=\"button\" class=\"btn btn-link\" onclick=\"getLacre('" + retorno[i].nr_serie + "')\">Editar</button>" +
                        "</tr>"
                    }
                    return htmlString;
                }

            </script>

    </body>

</html>